# frozen_string_literal: true

## This is meant to be more of an unsophisticated demo than a
## production tool.  Generating spec and ruby files should be part of
## your build system.  But this is how you can use it.

require 'optparse'
require 'json'
require 'c2ffi'

options = {}

OptionParser.new do |opts|
  opts.banner = 'Usage: c2ffi-ruby -l lib1[,lib2,...] [specfile [specfile..]]'
  opts.on('-h', '--help', 'Show this message') do
    puts opts
    exit
  end
end.parse!

if ARGV.empty?
  puts 'Input files required!'
  exit 1
end

spec = []
ARGV.each do |file|
  File.open(file) do |io|
    spec += JSON.parse(io.read, Hash[:symbolize_names, true])
  end
end

C2FFI::Parser.parse(spec)
